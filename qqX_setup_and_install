#!/usr/bin/env sh

##  THIS SCRIPT SHOULD BE RUN FROM INSIDE THE qqX DOWNLOAD/SOURCE FOLDER, where it will expect to find the right files 

#  From version 1.10.03  a posix friendly .sh script is used as a wrapper, to make sure that it double click executes properly
#  in Qt / KDE XFCE etc desktop environments.  

# Either, from the main qqX release download folder run "./qqX_setup_and_install"  
# OR  run the target script "./qqX_system_install"  from qqX.system folder directly

##  TO INSTALL:  
#   if your file manager allows > mouse click & 'run as program' or 'run in terminal'
#   OR: 
#   in the folder > right click > open in terminal >  type "./qqX_setup_and_install"   (note prefix ./)

##  CUSTOM TERMINAL SIZES & PROFILE  may be set just after the initial system checks 
#   in the target script "./qqX_system_install" in the qqX.system folder 

#   OR a terminal name may set here, a few lines further down. See 'UserTerm'

##  Copyright (c)  Alex Genovese   https://github.com/TuxVinyards
#   SMALL CODE SNIPPETS eg the function printColor MAY BE USED  
#   PERMISSIVELY in projects as MIT or similar, providing CLEAR ATTRIBUTIONS are shown.

# 	Otherwise:  

# Licence  GPL3   https://www.gnu.org/licenses 

# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.

# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.

# https://www.gnu.org/licenses  

# IF CODE IN GENERAL BECOMES USED IN ANY OTHER PROJECT,
# THE GPL3 LICENCE APPLIES & YOU SHOULD SHOW CLEAR ATTRIBUTIONS. 

##  qqX - quickemu quickget X terminal project   
# https://www.shellcheck.net/wiki/SC1090 for file sourcing, SC2317 for reachability
# shellcheck disable=SC1090
# shellcheck disable=SC2317
# shellcheck disable=SC2034


UserTerm=

printf "" > "/tmp/qqX.termlist"

if [ -n "${UserTerm}" ]; then  printf "%s\n" "${UserTerm}" > "/tmp/qqX.termlist"
fi

# https://stackoverflow.com/questions/35385962/arrays-in-a-posix-compliant-shell#35385978

set -- "gnome-terminal" "mate-terminal" "konsole" "qterminal" "xfce4-terminal" "alacritty" "uxterm" "xterm"

while [ -n "$1" ] ; do 
  if [ -n "$(command -v "$1")" ] ; then printf "%s\n" "$1" >> "/tmp/qqX.termlist"
  fi
  shift
done 

if [ -n "$(cat "/tmp/qqX.termlist")" ]; then UserTerm="$(head -n 1 "/tmp/qqX.termlist")"
fi

if [ "${UserTerm}" = "gnome-terminal" ]; then
  "${UserTerm}" --geometry 145x50 -- 'bash -c "./qqX.system/qqX_system_install"'
elif [ "${UserTerm}" = "uxterm" ] || [ "${UserTerm}" = "xterm" ]; then
  "${UserTerm}" -geometry 145x50 -fa truetype -fs 12 -fg white -bg black -e 'bash -c "./qqX.system/qqX_system_install"'
elif [ -n "${UserTerm}" ]; then
  "${UserTerm}" -e 'bash -c "./qqX.system/qqX_system_install"'
else
  exit
fi
